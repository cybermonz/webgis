<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Tasmania Web GIS — Lab 3 Q4</title>

<!-- OpenLayers -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.1/ol.css" />
<script src="https://cdn.jsdelivr.net/npm/ol@v10.6.1/dist/ol.js"></script>

<!-- Layer Switcher -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.css" />
<script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.js"></script>

<style>
  :root {
    --bg: #0d1117;
    --panel: #161b22;
    --accent: #58a6ff;
    --muted: #8b949e;
    --border: #30363d;
    --text: #e6edf3;
  }

  html, body {
    height: 100%;
    margin: 0;
    font-family: "Inter", "Segoe UI", Roboto, Arial, sans-serif;
    background-color: var(--bg);
    color: var(--text);
  }

  /* Modern gradient header */
  #header {
    padding: 18px 28px;
    background: linear-gradient(90deg, #0d1117 0%, #1a2230 100%);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.25);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #header h1 {
    font-size: 20px;
    margin: 0;
    color: var(--accent);
    letter-spacing: 0.5px;
    font-weight: 600;
  }

  #header h2 {
    margin: 0;
    font-size: 13px;
    color: var(--muted);
    font-weight: 400;
  }

  #map {
    width: 100%;
    height: calc(100vh - 70px);
  }

  /* Legend styling */
  .legend {
    position: absolute;
    top: 1.2em;
    right: 1.2em;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px 16px;
    width: 240px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.4);
    backdrop-filter: blur(6px);
  }

  .legend h3 {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: var(--accent);
    font-weight: 600;
    border-bottom: 1px solid var(--border);
    padding-bottom: 4px;
  }

  .legend-item {
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .legend-color {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid var(--border);
  }

  .legend-text {
    font-size: 13px;
    color: var(--text);
  }

  /* Control tweaks */
  .ol-control {
    background-color: var(--panel) !important;
    border-radius: 8px !important;
    border: 1px solid var(--border) !important;
    color: var(--text) !important;
  }

  .ol-layerswitcher {
    top: 1em !important;
    left: 1em !important;
    background: var(--panel) !important;
    border: 1px solid var(--border) !important;
    border-radius: 8px !important;
  }

  .ol-zoom {
    top: auto !important;
    bottom: 1.2em !important;
    left: 1em !important;
  }
</style>
</head>
<body>

<div id="header">
  <div>
    <h1>Tasmania Web GIS</h1>
    <h2>Lab 3: Question 4 • Author: Monica Layug</h2>
  </div>
</div>

<div id="map"></div>

<!-- Floating Legend -->
<div class="legend">
  <h3>Map Layers</h3>
  <div class="legend-item">
    <div class="legend-color" style="background:#58a6ff;"></div>
    <div class="legend-text">Carriageways (WMS)</div>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background:#2ea043;"></div>
    <div class="legend-text">Cadastre Parcels (WMS)</div>
  </div>
  <div class="legend-item">
    <div class="legend-color" style="background:#d29922;"></div>
    <div class="legend-text">Bus Trips (WMS)</div>
  </div>
</div>

<script>
const AZURE_KEY = "5XkeavvoPv61d5JlCImnXL0CSVyYmwFx6vkdpDUAVHc6JiNC2pPOJQQJ99BJACYeBjFhIhSbAAAgAZMP4Rzq";
const wmsUrl = "https://data.stategrowth.tas.gov.au/geoserver/ows";
const tasCenter = ol.proj.fromLonLat([146.8, -42.0]);

// Azure base layer
const azureRoad = new ol.layer.Tile({
  title: "Azure Maps Road",
  type: "base",
  visible: true,
  source: new ol.source.XYZ({
    url: `https://atlas.microsoft.com/map/tile?api-version=2022-08-01&tilesetId=microsoft.base.road&zoom={z}&x={x}&y={y}&subscription-key=${AZURE_KEY}`,
    crossOrigin: "anonymous",
    maxZoom: 19
  })
});

// WMS layers
const carriageways = new ol.layer.Tile({
  title: "Carriageways (WMS)",
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { LAYERS: "ssg:GEO_CARRIAGEWAY", FORMAT: "image/png", TRANSPARENT: true, VERSION: "1.3.0", CRS: "CRS:84" },
    serverType: "geoserver",
    crossOrigin: "anonymous"
  }),
  visible: true
});

const cadastre = new ol.layer.Tile({
  title: "Cadastre Parcels (WMS)",
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { LAYERS: "pam:GEO_CADASTRE", FORMAT: "image/png", TRANSPARENT: true, VERSION: "1.3.0", CRS: "CRS:84" },
    serverType: "geoserver",
    crossOrigin: "anonymous"
  }),
  visible: false
});

const busTrips = new ol.layer.Tile({
  title: "Bus Trips (WMS)",
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { LAYERS: "ssg:GEO_BRM_TRIP", FORMAT: "image/png", TRANSPARENT: true, VERSION: "1.3.0", CRS: "CRS:84" },
    serverType: "geoserver",
    crossOrigin: "anonymous"
  }),
  visible: false
});

// Map initialization
const map = new ol.Map({
  target: "map",
  layers: [
    new ol.layer.Group({ title: "Base Maps", layers: [azureRoad] }),
    new ol.layer.Group({ title: "Tasmania Overlays", layers: [carriageways, cadastre, busTrips] })
  ],
  view: new ol.View({
    center: tasCenter,
    zoom: 7
  }),
  controls: [
    new ol.control.Zoom(),
    new LayerSwitcher({ tipLabel: "Layers", groupSelectStyle: "children" })
  ]
});
</script>

</body>
</html>
