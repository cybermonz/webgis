<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tasmania Web GIS — Lab 3 Q4</title>

<!-- OpenLayers -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.1/ol.css" />
<script src="https://cdn.jsdelivr.net/npm/ol@v10.6.1/dist/ol.js"></script>

<!-- Layer Switcher -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.css" />
<script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.2/dist/ol-layerswitcher.js"></script>

<style>
  :root{
    --bg:#0b0f17;        /* urban dark */
    --ink:#e8eef7;       /* soft near-white */
    --muted:#93a3c6;     /* slatey label text */
    --line:#1c2433;      /* hairline */
    --panel:#0f1521cc;   /* translucent panel */
    --chip:#121a2a;      /* control chip */
    --accent:#7aa2ff;    /* electric blue accent */
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{ box-sizing:border-box; }
  html, body { height:100%; margin:0; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
  .bar{
    height:56px; display:flex; align-items:center; justify-content:space-between;
    padding:0 14px; border-bottom:1px solid var(--line);
    background:linear-gradient(180deg, #0b0f17 0%, #0b0f17 60%, #0c111c 100%);
  }
  .brand{ display:flex; align-items:center; gap:10px; }
  .dot{ width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 16px var(--accent); }
  .title{ margin:0; font-weight:700; font-size:14px; letter-spacing:.3px; }
  .subtitle{ margin:0; font-size:12px; color:var(--muted); }

  #map{ width:100%; height:calc(100vh - 56px); position:relative; }

  /* Compact floating panel for the layer switcher */
  .panel{
    position:absolute; top:14px; right:14px; z-index:10;
    width:280px; max-width:92vw; border:1px solid var(--line);
    background:var(--panel); backdrop-filter: blur(6px);
    border-radius:14px; box-shadow:var(--shadow); overflow:hidden;
  }
  .panel h4{
    margin:0; padding:10px 12px; font-size:12px; letter-spacing:.25px;
    border-bottom:1px solid var(--line); color:var(--muted);
  }
  .panel .content{ padding:8px 10px; }
  .ol-layerswitcher{
    background:transparent; border:none; box-shadow:none;
  }
  .ol-layerswitcher .panel{
    background:transparent;
  }
  .ol-layerswitcher .group, .ol-layerswitcher .layer{
    background:var(--chip); border:1px solid var(--line);
    border-radius:10px; padding:8px; margin:6px 0;
  }
  .ol-layerswitcher .title{ color:var(--ink); font-size:12px; }
  .ol-layerswitcher input[type="range"]{ width:100px; }

  /* OL control polish */
  .ol-zoom, .ol-attribution{
    filter: drop-shadow(0 8px 16px rgba(0,0,0,.35));
  }
  .ol-scale-line{
    background:#0c111caa; border-color:#253049; color:#d7e3ff;
  }
  /* Simple chips for base info bottom-left */
  .chips{
    position:absolute; left:12px; bottom:12px; display:flex; gap:8px; z-index:5;
  }
  .chip{
    background:var(--chip); border:1px solid var(--line); color:var(--muted);
    padding:6px 10px; border-radius:999px; font-size:12px; letter-spacing:.2px;
    backdrop-filter: blur(6px);
  }
</style>
</head>
<body>

<header class="bar">
  <div class="brand">
    <div class="dot"></div>
    <div>
      <p class="title">Tasmania Web GIS</p>
      <p class="subtitle">Lab 3 • Q4 • Author: Monica Layug</p>
    </div>
  </div>
</header>

<div id="map"></div>

<!-- Minimal layer switcher, mounted in a small floating panel -->
<div class="panel">
  <h4>Layers</h4>
  <div class="content" id="layerMount"></div>
</div>

<!-- Bottom-left chips -->
<div class="chips">
  <div class="chip">Basemap: Azure Road</div>
  <div class="chip">Overlays: Carriageways · Cadastre · Bus Trips</div>
</div>

<script>
/* ===== Minimal, stable config ===== */
const AZURE_KEY = "5XkeavvoPv61d5JlCImnXL0CSVyYmwFx6vkdpDUAVHc6JiNC2pPOJQQJ99BJACYeBjFhIhSbAAAgAZMP4Rzq";
const WMS_URL   = "https://data.stategrowth.tas.gov.au/geoserver/ows";
const PROJ      = ol.proj.get("EPSG:3857");
const centerTas = ol.proj.fromLonLat([146.8, -42.0]);

/* Base: single Azure road map (keeps things snappy & clean) */
const baseAzureRoad = new ol.layer.Tile({
  title:"Azure Maps Road", type:"base", visible:true,
  source: new ol.source.XYZ({
    url: `https://atlas.microsoft.com/map/tile?api-version=2022-08-01&tilesetId=microsoft.base.road&zoom={z}&x={x}&y={y}&subscription-key=${AZURE_KEY}`,
    maxZoom: 19,
    crossOrigin: "anonymous"
  })
});

/* Helper to create WMS tiles in EPSG:3857 (fixes CRS-related bugs) */
function wmsTile(layerName){
  return new ol.layer.Tile({
    title: layerName,
    source: new ol.source.TileWMS({
      url: WMS_URL,
      params: {
        LAYERS: layerName,
        STYLES: "",
        FORMAT: "image/png",
        TRANSPARENT: true,
        VERSION: "1.3.0",
        CRS: "EPSG:3857",
        TILED: true
      },
      serverType: "geoserver",
      crossOrigin: "anonymous"
    })
  });
}

/* Overlays (your three Tasmanian layers) */
const lyrCarriageways = wmsTile("ssg:GEO_CARRIAGEWAY"); lyrCarriageways.setVisible(true);
const lyrCadastre     = wmsTile("pam:GEO_CADASTRE");    lyrCadastre.setVisible(false);
const lyrBusTrips     = wmsTile("ssg:GEO_BRM_TRIP");    lyrBusTrips.setVisible(false);

/* Map */
const map = new ol.Map({
  target: "map",
  layers: [
    new ol.layer.Group({ title:"Base", layers:[baseAzureRoad] }),
    new ol.layer.Group({ title:"Tasmania Overlays", layers:[lyrCarriageways, lyrCadastre, lyrBusTrips] })
  ],
  view: new ol.View({ center:centerTas, zoom:7, projection:PROJ }),
  controls: ol.control.defaults({ attribution:true }).extend([
    new ol.control.ScaleLine()
  ])
});

/* Layer switcher — mounted inside our minimal floating panel */
const layerSwitcher = new LayerSwitcher({
  activationMode: 'click',
  startActive: true,
  groupSelectStyle: 'children'
});
map.addControl(layerSwitcher);
document.getElementById('layerMount').appendChild(layerSwitcher.element);

/* Optional: slight opacity so stack reads better (still minimal) */
lyrCarriageways.setOpacity(0.95);
lyrCadastre.setOpacity(0.85);
lyrBusTrips.setOpacity(0.95);
</script>
</body>
</html>
